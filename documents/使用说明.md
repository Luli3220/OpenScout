# OpenScout使用说明

开源人才智能雷达（OpenScout）是一套用于采集、分析并展示 GitHub 开源贡献者画像的轻量化工具链，包含数据采集脚本、指标计算与前端展示页面。

## 目录结构（概要）

- `src/`：数据采集与计算脚本（tech stack、代表仓库、Agent B 上下文、OpenDigger 指标采集、雷达分计算等）。
- `data/`：采集数据目录（`raw_users/{username}/`、`macro_data/`、`radar_scores.json` 等）。
- `OpenScout.htm`：前端页面（静态 HTML + JS，调用后端 API 渲染可视化）。
- `server.py`：FastAPI 后端，提供静态页面和若干数据接口（`/api/radar/{username}`、`/api/tech_stack/{username}`、`/api/representative/{username}` 等）。
- `init.py`：初始化 runner，按顺序运行 `src/` 中的采集脚本以生成 `data/` 中所需文件。
- `requirements.txt`：Python 依赖（`requests`, `tqdm` 等）。

## 快速开始

1. 克隆仓库并进入目录：

```bash
git clone <repo-url>
cd OpenScout
```

2. 创建并激活 Conda 环境（仓库示例使用环境名 `Openscout`）：

```bash
conda create -n Openscout python=3.10 -y
conda activate Openscout
```

3. 安装依赖：

```bash
python -m pip install -r requirements.txt
```

4. 配置 GitHub Token（可选但强烈推荐）:

在项目根创建 `config.json`，示例：

```json
{
	"github_token": "YOUR_PERSONAL_ACCESS_TOKEN",
	"github_tokens": ["token1", "token2"]
}
```

5. 准备用户列表：编辑 `data/users_list.json`（一个 GitHub 登录名数组），或使用 `src/get_user_name.py` 自动生成列表。

6. 运行初始化脚本（默认只抓取缺失的数据）：

```bash
# 增量运行，跳过已存在数据
python init.py

# 强制覆盖（重新抓取/覆盖所有数据）
python init.py --refresh
```

可用选项：`--skip-tech`、`--skip-repos`、`--skip-agentb`、`--skip-metrics`、`--skip-macro`、`--skip-radar`。

7. 启动后端服务器并打开浏览器查看页面：

```bash
python server.py
# 或使用 uvicorn
uvicorn server:app --host 0.0.0.0 --port 8001
```

打开 http://localhost:8001

## 后端 API（常用）

- `GET /api/radar/{username}`：返回用户雷达维度数据与时间序列（OpenRank 等）。
- `GET /api/tech_stack/{username}`：返回 `data/raw_users/{username}/tech_stack.json`（仓库语言与 README 摘要）。
- `GET /api/representative/{username}`：返回 `representative_repos.json`（按 stars 排序的代表仓库及贡献得分）。
- `GET /api/github/{username}`：代理 GitHub 个人资料并缓存头像。

## 重要说明与建议

- 所有爬取脚本大量依赖 GitHub REST API，若不提供 `github_token`，容易触发速率限制。建议在 `config.json` 中配置 token。可通过 `github_tokens` 提供多个 token 以便轮询。\
- `init.py --refresh` 会将 `--refresh` 传给每个子脚本，强制覆盖已有数据；默认行为为增量（跳过已存在文件），以便分阶段抓取。\
- 部分指标（如合并 PR / 问题统计）使用 Events 或 Search API 的近似值，若需要更精确统计可进一步扩展脚本，但会显著增加 API 请求量。

## 常见问题与调试

- 报错 `ModuleNotFoundError: No module named 'requests'`：请确保已激活正确的 conda 环境并安装依赖（见第 3 步）。\
- 若 `calculate_radar.py` 报 KeyError，通常说明某个用户的原始采集文件缺失或结构异常，检查 `data/raw_users/{username}/` 下的 `{username}_*.json` 文件是否完整。\

## 开发与二次扩展

- 增加新的采集步骤：在 `src/` 添加脚本并在 `init.py` 中注册执行顺序。\
- 前端 `OpenScout.htm` 使用 Chart.js 渲染雷达/堆栈/趋势图，可按需修改样式或增加组件。\

