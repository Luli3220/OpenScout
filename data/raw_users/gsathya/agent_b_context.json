{
  "username": "gsathya",
  "agent_b_context": "\n=== PR #31442 in facebook/react (Stars: 241669) ===\nFile: compiler/packages/babel-plugin-react-compiler/src/Optimization/OutlineJsx.ts\nPatch:\n@@ -219,10 +219,20 @@ type OutlinedJsxAttribute = {\n function collectProps(\n   instructions: Array<JsxInstruction>,\n ): Array<OutlinedJsxAttribute> | null {\n+  let id = 1;\n+\n+  function generateName(oldName: string): string {\n+    let newName = oldName;\n+    while (seen.has(newName)) {\n+      newName = `${oldName}${id++}`;\n+    }\n+    seen.add(newName);\n+    return newName;\n+  }\n+\n   const attributes: Array<OutlinedJsxAttribute> = [];\n   const jsxIds = new Set(instructions.map(i => i.lvalue.identifier.id));\n   const seen: Set<string> = new Set();\n-  let id = 1;\n \n   for (const instr of instructions) {\n     const {value} = instr;\n@@ -233,25 +243,29 @@ function collectProps(\n       }\n \n       if (at.kind === 'JsxAttribute') {\n-        let newName = at.name;\n-        while (seen.has(newName)) {\n-          newName = `${at.name}${id++}`;\n-        }\n+        const newName = generateName(at.name);\n         attributes.push({\n           originalName: at.name,\n           newName,\n           plac\n... (truncated)\n\nFile: compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/jsx-outlining-with-non-jsx-children.js\nPatch:\n@@ -7,12 +7,14 @@ function Component({arr}) {\n         return (\n           <Bar key={id} x={x}>\n             <Baz i={i}>Test</Baz>\n+            <Foo k={i} />\n           </Bar>\n         );\n       })}\n     </>\n   );\n }\n+\n function Bar({x, children}) {\n   return (\n     <>\n@@ -22,8 +24,17 @@ function Bar({x, children}) {\n   );\n }\n \n-function Baz({i}) {\n-  return i;\n+function Baz({i, children}) {\n+  return (\n+    <>\n+      {i}\n+      {children}\n+    </>\n+  );\n+}\n+\n+function Foo({k}) {\n+  return k;\n }\n \n function useX() {\n\n\n=== PR #31441 in facebook/react (Stars: 241669) ===\nFile: compiler/packages/babel-plugin-react-compiler/src/Optimization/OutlineJsx.ts\nPatch:\n@@ -222,6 +222,8 @@ function collectProps(\n   const attributes: Array<OutlinedJsxAttribute> = [];\n   const jsxIds = new Set(instructions.map(i => i.lvalue.identifier.id));\n   const seen: Set<string> = new Set();\n+  let id = 1;\n+\n   for (const instr of instructions) {\n     const {value} = instr;\n \n@@ -230,21 +232,17 @@ function collectProps(\n         return null;\n       }\n \n-      /*\n-       * TODO(gsn): Handle attributes that have same value across\n-       * the outlined jsx instructions.\n-       */\n-      if (seen.has(at.name)) {\n-        return null;\n-      }\n-\n       if (at.kind === 'JsxAttribute') {\n-        seen.add(at.name);\n+        let newName = at.name;\n+        while (seen.has(newName)) {\n+          newName = `${at.name}${id++}`;\n+        }\n         attributes.push({\n           originalName: at.name,\n-          newName: at.name,\n+          newName,\n           place: at.place,\n         });\n+        seen.add(newName);\n       }\n     }\n \n\nFile: compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/jsx-outlining-dup-key-diff-value.js\nPatch:\n@@ -0,0 +1,41 @@\n+// @enableJsxOutlining\n+function Component({arr}) {\n+  const x = useX();\n+  return (\n+    <>\n+      {arr.map((i, id) => {\n+        return (\n+          <Bar key={id} x={x}>\n+            <Baz i={i + 'i'}></Baz>\n+            <Foo k={i + 'j'}></Foo>\n+          </Bar>\n+        );\n+      })}\n+    </>\n+  );\n+}\n+function Bar({x, children}) {\n+  return (\n+    <>\n+      {x}\n+      {children}\n+    </>\n+  );\n+}\n+\n+function Baz({i}) {\n+  return i;\n+}\n+\n+function Foo({k}) {\n+  return k;\n+}\n+\n+function useX() {\n+  return 'x';\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{arr: ['foo', 'bar']}],\n+};\n\nFile: compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/jsx-outlining-dupe-attr-after-rename.js\nPatch:\n@@ -0,0 +1,42 @@\n+// @enableJsxOutlining\n+function Component({arr}) {\n+  const x = useX();\n+  return (\n+    <>\n+      {arr.map((i, id) => {\n+        return (\n+          <Bar key={id} x={x}>\n+            <Foo k={i + 'i'}></Foo>\n+            <Foo k={i + 'j'}></Foo>\n+            <Baz k1={i + 'j'}></Baz>\n+          </Bar>\n+        );\n+      })}\n+    </>\n+  );\n+}\n+function Bar({x, children}) {\n+  return (\n+    <>\n+      {x}\n+      {children}\n+    </>\n+  );\n+}\n+\n+function Baz({k1}) {\n+  return k1;\n+}\n+\n+function Foo({k}) {\n+  return k;\n+}\n+\n+function useX() {\n+  return 'x';\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{arr: ['foo', 'bar']}],\n+};\n\nFile: compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/jsx-outlining-dupe-key-dupe-component.js\nPatch:\n@@ -0,0 +1,37 @@\n+// @enableJsxOutlining\n+function Component({arr}) {\n+  const x = useX();\n+  return (\n+    <>\n+      {arr.map((i, id) => {\n+        return (\n+          <Bar key={id} x={x}>\n+            <Foo k={i + 'i'}></Foo>\n+            <Foo k={i + 'j'}></Foo>\n+          </Bar>\n+        );\n+      })}\n+    </>\n+  );\n+}\n+function Bar({x, children}) {\n+  return (\n+    <>\n+      {x}\n+      {children}\n+    </>\n+  );\n+}\n+\n+function Foo({k}) {\n+  return k;\n+}\n+\n+function useX() {\n+  return 'x';\n+}\n+\n+export const FIXTURE_ENTRYPOINT = {\n+  fn: Component,\n+  params: [{arr: ['foo', 'bar']}],\n+};\n\nFile: compiler/packages/babel-plugin-react-compiler/src/__tests__/fixtures/compiler/jsx-outlining-duplicate-prop.js\nPatch:\n@@ -27,8 +27,8 @@ function Baz({i}) {\n   return i;\n }\n \n-function Foo({k}) {\n-  return k;\n+function Foo({i}) {\n+  return i;\n }\n \n function useX() {\n\n\n=== PR #31440 in facebook/react (Stars: 241669) ===\n"
}