{
  "username": "krambertech",
  "agent_b_context": "\n=== PR #7867 in facebook/react (Stars: 241669) ===\n\n=== PR #3271 in mui/material-ui (Stars: 97474) ===\n\n=== PR #80 in andrew--r/channels (Stars: 4444) ===\n\n=== Fallback Source Audit: api/src/routes/tils.test.ts (Size: 20409 bytes) ===\nimport { describe, it, expect, vi, beforeEach, afterEach } from \"vitest\";\nimport express from \"express\";\nimport supertest from \"supertest\";\n\nimport { db } from \"../db.js\";\nimport tilsRouter from \"./tils.js\";\nimport authRouter from \"./auth.js\";\n\n// Create a test app with the tils router\nconst createTestApp = () => {\n  const app = express();\n  app.use(express.json());\n  app.use(\"/auth\", authRouter);\n  app.use(\"/tils\", tilsRouter);\n  return app;\n};\n\nconst mockUserData = {\n  avatarUrl: \"https://example.com/avatar.png\",\n  displayName: \"Test User\",\n  githubProfileUrl: \"https://github.com/testuser\",\n  publicReposCount: 5,\n  publicGistsCount: 2,\n  followersCount: 10,\n  followingCount: 5,\n  githubProfileCreatedAt: \"2020-01-01T00:00:00Z\",\n};\n\n// Helper function to create a test user and get a token\nconst seedUser = (username: string = \"myUser\") => {\n  const createResult = db.users.create({\n    username,\n    password: \"Password123!\",\n    ...mockUserData,\n  });\n\n  if (!createResult.ok) {\n    throw new Error(\"Failed to create user\");\n  }\n\n  const user = createResult.data;\n\n  const tokenResult = db.tokens.create(user.id);\n\n  if (!tokenResult.ok) {\n    throw new Error(\"Failed to create token\");\n  }\n\n  return { userId: user.id, token: tokenResult.data };\n};\n\n// Helper function to create a TIL\nconst createTestTil = async (\n  app: ReturnType<typeof createTestApp>,\n  token: string,\n  tilData = {\n    title: \"Test TIL\",\n    content: \"This is a test TIL content\",\n  }\n) => {\n  const response = await supertest(app)\n    .post(\"/tils\")\n    .set(\"Authorization\", `Bearer ${token}`)\n    .send(tilData);\n\n  return response.body;\n};\n\nbeforeEach(() => {\n  vi.clearAllMocks();\n  // Clear the database before each test\n  db.clear();\n});\n\nafterEach(() => {\n  vi.resetAllMocks();\n});\n\ndescribe(\"POST /tils\", () => {\n  it(\"should create a new TIL when authenticated\", async () => {\n    const app = createTestApp();\n    const { token } = seedUser();\n\n    const tilData = {\n      title: \"Test TIL\",\n      content: \"This is a test TIL content\",\n    };\n\n    const response = await supertest(app)\n      .post(\"/tils\")\n      .set(\"Authorization\", `Bearer ${token}`)\n      .send(tilData);\n\n    // Assertions\n    expect(response.status).toBe(201);\n    expect(response.body).toHaveProperty(\"id\");\n    expect(response.body).toHaveProperty(\"title\", tilData.title);\n    expect(response.body).toHaveProperty(\"content\", tilData.content);\n    expect(response.body).toHaveProperty(\"createdAt\");\n    expect(response.body).toHaveProperty(\"updatedAt\");\n\n    // Verify TIL was created in the database\n    const tilResult = db.tils.getById(response.body.id);\n    expect(tilResult.ok).toBe(true);\n\n    if (tilResult.ok) {\n      expect(tilResult.data.title).toBe(tilData.title);\n      expect(tilResult.data.content).toBe(tilData.content);\n    }\n  });\n\n  it(\"should return 401 if not authenticated\", async () => {\n    const app = createTestApp();\n\n    const tilData = {\n      title: \"Test TIL\",\n      content: \"This is a test TIL cont\n... (file truncated)\n"
}