{
  "username": "jmcdo29",
  "agent_b_context": "\n=== PR #15010 in nestjs/nest (Stars: 73937) ===\nFile: packages/platform-express/adapters/express-adapter.ts\nPatch:\n@@ -30,7 +30,7 @@ import type { Server } from 'http';\n import * as http from 'http';\n import * as https from 'https';\n import { pathToRegexp } from 'path-to-regexp';\n-import { Duplex, pipeline } from 'stream';\n+import { Duplex, Writable } from 'stream';\n import { NestExpressBodyParserOptions } from '../interfaces/nest-express-body-parser-options.interface';\n import { NestExpressBodyParserType } from '../interfaces/nest-express-body-parser.interface';\n import { ServeStaticOptions } from '../interfaces/serve-static-options.interface';\n@@ -86,17 +86,13 @@ export class ExpressAdapter extends AbstractHttpAdapter<\n       ) {\n         response.setHeader('Content-Length', streamHeaders.length);\n       }\n-      return pipeline(\n-        body.getStream().once('error', (err: Error) => {\n-          body.errorHandler(err, response);\n-        }),\n-        response,\n-        (err: any) => {\n-          if (err) {\n-            body.errorLogger(err);\n-          }\n-        },\n-      );\n+      const strea\n... (truncated)\n\n\n=== PR #12622 in nestjs/nest (Stars: 73937) ===\nFile: integration/microservices/e2e/sum-rpc-async.spec.ts\nPatch:\n@@ -0,0 +1,98 @@\n+import {\n+  Controller,\n+  INestMicroservice,\n+  Injectable,\n+  Module,\n+} from '@nestjs/common';\n+import {\n+  AsyncOptions,\n+  ClientTCP,\n+  ClientsModule,\n+  MessagePattern,\n+  MicroserviceOptions,\n+  Payload,\n+  TcpClientOptions,\n+  Transport,\n+} from '@nestjs/microservices';\n+import { expect } from 'chai';\n+import { NestFactory } from '@nestjs/core';\n+\n+let port: number;\n+\n+do {\n+  port = Math.round(Math.random() * 10000);\n+} while (port < 1000);\n+\n+@Injectable()\n+class RpcOptionsProvider {\n+  getOptions(): TcpClientOptions {\n+    return {\n+      transport: Transport.TCP,\n+      options: {\n+        port,\n+        host: '0.0.0.0',\n+      },\n+    };\n+  }\n+}\n+\n+@Controller()\n+class RpcController {\n+  @MessagePattern({ cmd: 'sum' })\n+  sumPayload(@Payload() payload: number[]) {\n+    return payload.reduce((a, b) => a + b, 0);\n+  }\n+}\n+\n+@Module({\n+  imports: [\n+    ClientsModule.register([\n+      {\n+        name: 'RPC_CLIENT',\n+        transport: Transport.TCP,\n+      \n... (truncated)\n\nFile: packages/microservices/interfaces/microservice-configuration.interface.ts\nPatch:\n@@ -1,4 +1,4 @@\n-import { Type } from '@nestjs/common';\n+import { FactoryProvider, InjectionToken, Type } from '@nestjs/common';\n import { ConnectionOptions } from 'tls';\n import { Transport } from '../enums/transport.enum';\n import { ChannelOptions } from '../external/grpc-options.interface';\n@@ -28,6 +28,16 @@ export type MicroserviceOptions =\n   | KafkaOptions\n   | CustomStrategy;\n \n+export type AsyncMicroserviceOptions = {\n+  inject: InjectionToken[];\n+  useFactory: (...args: any[]) => MicroserviceOptions;\n+};\n+\n+export type AsyncOptions<T extends object> = {\n+  inject: InjectionToken[];\n+  useFactory: (...args: any[]) => T;\n+};\n+\n /**\n  * @publicApi\n  */\n\nFile: packages/microservices/nest-microservice.ts\nPatch:\n@@ -17,7 +17,10 @@ import { GraphInspector } from '@nestjs/core/inspector/graph-inspector';\n import { NestApplicationContext } from '@nestjs/core/nest-application-context';\n import { Transport } from './enums/transport.enum';\n import { CustomTransportStrategy } from './interfaces/custom-transport-strategy.interface';\n-import { MicroserviceOptions } from './interfaces/microservice-configuration.interface';\n+import {\n+  AsyncMicroserviceOptions,\n+  MicroserviceOptions,\n+} from './interfaces/microservice-configuration.interface';\n import { MicroservicesModule } from './microservices-module';\n import { Server } from './server/server';\n import { ServerFactory } from './server/server-factory';\n@@ -43,7 +46,8 @@ export class NestMicroservice\n \n   constructor(\n     container: NestContainer,\n-    config: NestMicroserviceOptions & MicroserviceOptions = {},\n+    config: NestMicroserviceOptions &\n+      (MicroserviceOptions | AsyncMicroserviceOptions) = {},\n     private readonly graphInspector: Gr\n... (truncated)\n\n\n=== PR #2237 in nestjs/throttler (Stars: 678) ===\n"
}